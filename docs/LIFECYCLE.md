# GitOps Lab - Lifecycle Management

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
```batch
start.bat
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç pre-flight –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç Podman machine (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç k3d —Å–µ—Ç—å
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç docker-compose —Å–µ—Ä–≤–∏—Å—ã (Gitea, Registry, Woodpecker)
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç platform-bootstrap –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ k3d, ArgoCD, MLflow

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ "–≥—Ä—è–∑–Ω–æ–µ" —Å–æ—Å—Ç–æ—è–Ω–∏–µ (k3d –∫–ª–∞—Å—Ç–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã), —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–¥–µ–ª–∞—Ç—å `stop.bat --clean`.

---

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### –ú—è–≥–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```batch
stop.bat
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç docker-compose —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç standalone –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –£–¥–∞–ª—è–µ—Ç k3d –∫–ª–∞—Å—Ç–µ—Ä
- ‚ùå **–ù–ï** —É–¥–∞–ª—è–µ—Ç volumes (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞:** –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ –ø–æ–∑–∂–µ.

---

#### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```batch
stop.bat --clean
```
–∏–ª–∏
```batch
stop.bat -c
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –í—Å—ë –∏–∑ –º—è–≥–∫–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ +
- ‚úÖ –£–¥–∞–ª—è–µ—Ç volumes (Gitea, Woodpecker, Registry)
- ‚úÖ –£–¥–∞–ª—è–µ—Ç k3d volumes
- ‚úÖ –£–¥–∞–ª—è–µ—Ç k3d —Å–µ—Ç—å

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞:**
- üîß –ù—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- üêõ –ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–∞–º–∏ ArgoCD
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ç—Ä–µ–±—É—é—â–µ–µ —á–∏—Å—Ç–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
- üß™ –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º E2E —Ç–µ—Å—Ç–æ–≤

---

### –ë—ã—Å—Ç—Ä—ã–π –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```batch
restart.bat
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –í—ã–∑—ã–≤–∞–µ—Ç `stop.bat --clean`
2. –ñ–¥–µ—Ç 5 —Å–µ–∫—É–Ω–¥
3. –í—ã–∑—ã–≤–∞–µ—Ç `start.bat`

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞:** –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å —á–∏—Å—Ç—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ –°—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –†–∞–±–æ—Ç–∞

```batch
# –£—Ç—Ä–æ–º
start.bat

# –†–∞–±–æ—Ç–∞...

# –í–µ—á–µ—Ä–æ–º (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ)
stop.bat
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–±–ª–µ–º—ã —Å ArgoCD/OAuth

```batch
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
stop.bat --clean

# –ß–∏—Å—Ç—ã–π —Å—Ç–∞—Ä—Ç
start.bat
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –∫—ç—à–∏ –æ—á–∏—â–µ–Ω—ã, OAuth –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–ø—É—Å–∫ E2E –¢–µ—Å—Ç–æ–≤

```batch
# –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
restart.bat

# –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è bootstrap
podman logs -f platform-bootstrap

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
run-e2e.bat
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```batch
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å –æ—á–∏—Å—Ç–∫–æ–π
stop.bat --clean

# 2. –ò–∑–º–µ–Ω–∏—Ç—å .env, docker-compose.yml, etc.
notepad .env

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
start.bat
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å—Ç–∞—Ä–æ–π.

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ü—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Inconsistent state" –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–ü—Ä–∏—á–∏–Ω–∞:** k3d –∫–ª–∞—Å—Ç–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ Gitea/Woodpecker –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```batch
stop.bat --clean
start.bat
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: ArgoCD –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ö—ç—à Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ ArgoCD.

**–†–µ—à–µ–Ω–∏–µ 1 (–±—ã—Å—Ç—Ä–æ–µ):**
```batch
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
podman exec k3d-gitopslab-server-0 kubectl delete application mlflow -n argocd
# –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ root-app
```

**–†–µ—à–µ–Ω–∏–µ 2 (–Ω–∞–¥–µ–∂–Ω–æ–µ):**
```batch
restart.bat
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: Woodpecker OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ client_id/secret –º–µ–∂–¥—É Gitea –∏ Woodpecker.

**–†–µ—à–µ–Ω–∏–µ:**
```batch
stop.bat --clean
start.bat
# –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ bootstrap –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: MLflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (ImagePullBackOff)

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π registry URL –∏–ª–∏ –æ–±—Ä–∞–∑ –Ω–µ —Å–æ–±—Ä–∞–Ω.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```batch
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–∑ –≤ registry
podman exec k3d-registry.localhost sh -c "ls -la /var/lib/registry/docker/registry/v2/repositories/"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç
grep "image:" gitops/apps/mlflow/deployment.yaml
```

**–†–µ—à–µ–Ω–∏–µ:**
```batch
# –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –µ—Å—Ç—å, –Ω–æ URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏:
git add gitops/apps/mlflow/deployment.yaml
git commit -m "fix: mlflow registry URL"
git push gitea main

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
podman exec k3d-gitopslab-server-0 kubectl delete pod -n apps -l app=mlflow
```

---

## üìä –°–æ—Å—Ç–æ—è–Ω–∏—è –°–∏—Å—Ç–µ–º—ã

### –ß–∏—Å—Ç–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ
```
‚úÖ Volumes –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
‚úÖ k3d –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚úÖ k3d —Å–µ—Ç—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã
```

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:** `stop.bat --clean`

---

### –†–∞–±–æ—á–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ
```
‚úÖ Volumes —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ
‚úÖ k3d –∫–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—â–µ–Ω
‚úÖ k3d —Å–µ—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚úÖ –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Running
‚úÖ ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Synced
```

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:** `start.bat` –ø–æ—Å–ª–µ —á–∏—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

### –ì—Ä—è–∑–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ (‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω–æ–µ)
```
‚ö†Ô∏è Volumes —Å—É—â–µ—Å—Ç–≤—É—é—Ç
‚ö†Ô∏è k3d –∫–ª–∞—Å—Ç–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
```

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:** `stop.bat` (–º—è–≥–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ArgoCD –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫—ç—à–∏
- OAuth —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:** `stop.bat --clean` ‚Üí `start.bat`

---

## üõ†Ô∏è Best Practices

### ‚úÖ DO:
1. **–ò—Å–ø–æ–ª—å–∑—É–π `stop.bat --clean` –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏**
2. **–ó–∞–ø—É—Å–∫–∞–π `restart.bat` –ø–µ—Ä–µ–¥ E2E —Ç–µ—Å—Ç–∞–º–∏**
3. **–ü—Ä–æ–≤–µ—Ä—è–π health checks –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞:** `health-check.bat smoke`
4. **–ö–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Gitea** –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å ArgoCD
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å –ª–æ–≥–∏ bootstrap:** `podman logs -f platform-bootstrap`

### ‚ùå DON'T:
1. **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é –≤ k3d –∫–ª–∞—Å—Ç–µ—Ä–µ** (–∏—Å–ø–æ–ª—å–∑—É–π Git)
2. **–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤—Ä—É—á–Ω—É—é** (–∏—Å–ø–æ–ª—å–∑—É–π `stop.bat`)
3. **–ù–µ —É–¥–∞–ª—è–π volumes –≤—Ä—É—á–Ω—É—é** (–∏—Å–ø–æ–ª—å–∑—É–π `stop.bat --clean`)
4. **–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ "–≥—Ä—è–∑–Ω–æ–º" —Å–æ—Å—Ç–æ—è–Ω–∏–∏**

---

## üìù Changelog

### v2.0.0 (2026-01-04)
- ‚ú® –î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º `--clean` –≤ `stop.bat`
- ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ "–≥—Ä—è–∑–Ω–æ–≥–æ" —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `start.bat`
- ‚ú® –°–æ–∑–¥–∞–Ω `restart.bat` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- üîß `stop.bat` —Ç–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ—Ç k3d –∫–ª–∞—Å—Ç–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- üìö –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ lifecycle management

### v1.0.0 (2026-01-03)
- üéâ –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è `start.bat` –∏ `stop.bat`
